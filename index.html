<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dead Behind The Mask</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gold: #d4af37;
            --dark-red: #8b0000;
            --deep-black: #0a0a0a;
            --rich-burgundy: #722f37;
            --antique-white: #faf0e6;
            --shadow-gold: rgba(212, 175, 55, 0.4);
            --blood-red: #b60505;
            --success-green: #228b22;
            --warning-orange: #ff8c00;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: 
                radial-gradient(ellipse at 30% 80%, rgba(139, 0, 0, 0.2) 0%, transparent 60%),
                radial-gradient(ellipse at 70% 20%, rgba(212, 175, 55, 0.15) 0%, transparent 55%),
                radial-gradient(ellipse at 50% 50%, rgba(114, 47, 55, 0.25) 0%, transparent 70%),
                linear-gradient(135deg, var(--deep-black) 0%, var(--rich-burgundy) 20%, #4a1f24 40%, #2d1215 60%, var(--rich-burgundy) 80%, var(--deep-black) 100%);
            color: var(--antique-white);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    30deg,
                    transparent,
                    transparent 2px,
                    rgba(212, 175, 55, 0.03) 2px,
                    rgba(212, 175, 55, 0.03) 4px
                ),
                repeating-linear-gradient(
                    -30deg,
                    transparent,
                    transparent 2px,
                    rgba(139, 0, 0, 0.02) 2px,
                    rgba(139, 0, 0, 0.02) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .institution-logo {
            position: fixed;
            top: 15px;
            left: 15px;
            width: 90px;
            height: 90px;
            z-index: 100;
            opacity: 0.95;
            transition: opacity 0.3s ease;
        }

        .institution-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--primary-gold);
            border-radius: 50%;
            animation: float 15s infinite ease-in-out;
            opacity: 0.5;
            box-shadow: 0 0 6px var(--primary-gold);
        }

        .particle:nth-child(even) {
            background: rgba(139, 0, 0, 0.6);
            box-shadow: 0 0 4px rgba(139, 0, 0, 0.6);
            animation-duration: 18s;
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1); 
                opacity: 0.3; 
            }
            50% { 
                transform: translateY(-80px) rotate(180deg) scale(1.2); 
                opacity: 1; 
            }
        }

        .header {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 4rem 1rem 3rem 1rem;
            background: 
                linear-gradient(180deg, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.5) 50%, rgba(0,0,0,0.2) 100%);
            overflow: hidden;
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 8vw, 4rem);
            font-weight: 700;
            color: var(--primary-gold);
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.8), 
                0 0 15px var(--blood-red);
            margin-bottom: 1rem;
            opacity: 0;
            animation: titleReveal 2s ease-out 0.5s forwards;
            position: relative;
            z-index: 5;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            font-style: italic;
            color: var(--antique-white);
            margin-bottom: 1.5rem;
            opacity: 0;
            animation: fadeInUp 1.8s ease-out 1.2s forwards;
            position: relative;
            z-index: 5;
            max-width: 600px;
            margin: 0 auto 1.5rem auto;
            line-height: 1.4;
            font-weight: 400;
            padding: 0 1rem;
        }

        .ornament {
            font-size: 1.8rem;
            color: var(--primary-gold);
            margin: 1rem 0;
            opacity: 0;
            animation: fadeInUp 1.2s ease-out 1.8s forwards;
            position: relative;
            z-index: 5;
        }

        @keyframes titleReveal {
            from { opacity: 0; transform: translateY(30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-container {
            position: relative;
            z-index: 10;
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .nav-btn, .quiz-btn, .back-btn, .audio-btn, .vote-btn {
            background: linear-gradient(145deg, var(--rich-burgundy), var(--dark-red));
            color: var(--primary-gold);
            border: 2px solid var(--primary-gold);
            padding: 0.8rem 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            min-width: 180px;
        }

        .nav-btn::before, .quiz-btn::before, .back-btn::before, .audio-btn::before, .vote-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover, .quiz-btn:hover, .back-btn:hover, .audio-btn:hover, .vote-btn:hover {
            transform: translateY(-2px);
            border-color: var(--antique-white);
        }

        .nav-btn:hover::before, .quiz-btn:hover::before, .back-btn:hover::before, .audio-btn:hover::before, .vote-btn:hover::before {
            left: 100%;
        }

        .audio-btn {
            min-width: auto;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }

        .vote-btn {
            background: linear-gradient(145deg, var(--success-green), #1e6b1e);
            min-width: auto;
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .vote-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .vote-btn:disabled:hover {
            transform: none;
            border-color: var(--primary-gold);
        }

        .content {
            position: relative;
            z-index: 10;
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }

        .characters-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .character-card {
            background: linear-gradient(145deg, rgba(20,20,20,0.95), rgba(114,47,55,0.7));
            border: 2px solid var(--primary-gold);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(30px);
            animation: cardReveal 0.6s ease-out forwards;
        }

        .character-card:nth-child(1) { animation-delay: 0.1s; }
        .character-card:nth-child(2) { animation-delay: 0.15s; }
        .character-card:nth-child(3) { animation-delay: 0.2s; }
        .character-card:nth-child(4) { animation-delay: 0.25s; }
        .character-card:nth-child(5) { animation-delay: 0.3s; }
        .character-card:nth-child(6) { animation-delay: 0.35s; }
        .character-card:nth-child(7) { animation-delay: 0.4s; }
        .character-card:nth-child(8) { animation-delay: 0.45s; }
        .character-card:nth-child(9) { animation-delay: 0.5s; }
        .character-card:nth-child(10) { animation-delay: 0.55s; }
        .character-card:nth-child(11) { animation-delay: 0.6s; }

        @keyframes cardReveal {
            to { opacity: 1; transform: translateY(0); }
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--shadow-gold) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .character-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--antique-white);
        }

        .character-card:hover::before {
            opacity: 0.08;
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 3px solid var(--primary-gold);
        }

        .character-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .character-card:hover .character-avatar {
            transform: scale(1.05);
        }

        .character-name {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-gold);
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            letter-spacing: 0.5px;
        }

        .character-role {
            font-size: 1rem;
            font-style: italic;
            color: var(--antique-white);
            margin-bottom: 0.8rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .character-age {
            font-size: 0.95rem;
            color: var(--primary-gold);
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        .character-description {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--antique-white);
            margin-bottom: 1rem;
            opacity: 0.85;
        }

        .character-motive {
            background: rgba(139, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid var(--blood-red);
        }

        .motive-title {
            font-size: 0.8rem;
            color: var(--primary-gold);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .motive-text {
            font-size: 0.9rem;
            color: var(--antique-white);
            line-height: 1.4;
        }

        .clues-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--primary-gold);
        }

        .clues-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--primary-gold);
            margin-bottom: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            padding: 0.4rem;
            border-radius: 5px;
        }

        .clues-title:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .clues-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .clues-content.revealed {
            max-height: 400px;
            opacity: 1;
        }

        .clue-item {
            background: rgba(0,0,0,0.4);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-left: 2px solid var(--primary-gold);
            border-radius: 5px;
            font-size: 0.85rem;
            line-height: 1.4;
            transform: translateX(-15px);
            opacity: 0;
            animation: slideInClue 0.4s ease forwards;
        }

        .clue-item:nth-child(1) { animation-delay: 0.1s; }
        .clue-item:nth-child(2) { animation-delay: 0.2s; }
        .clue-item:nth-child(3) { animation-delay: 0.3s; }
        .clue-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes slideInClue {
            to { transform: translateX(0); opacity: 1; }
        }

        .victim-card {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.4), rgba(20,20,20,0.95));
            border: 3px solid var(--blood-red);
        }

        .victim-card .character-name {
            color: var(--blood-red);
        }

        .back-btn {
            background: transparent;
            color: var(--primary-gold);
            border: 2px solid var(--primary-gold);
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            min-width: auto;
        }

        .back-btn:hover {
            background: var(--primary-gold);
            color: var(--deep-black);
            transform: translateX(-3px);
        }

        /* Vocabulary assistance */
        .vocab-word {
            border-bottom: 1px dotted var(--primary-gold);
            cursor: help;
            position: relative;
        }

        .vocab-word:hover {
            color: var(--primary-gold);
        }

        /* Quiz section */
        .quiz-section {
            background: linear-gradient(145deg, rgba(20,20,20,0.95), rgba(114,47,55,0.7));
            border: 2px solid var(--primary-gold);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .quiz-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--primary-gold);
            margin-bottom: 1.5rem;
        }

        .question {
            background: rgba(0,0,0,0.4);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 3px solid var(--primary-gold);
        }

        .question h3 {
            color: var(--primary-gold);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .question-options {
            display: grid;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .option {
            background: rgba(114,47,55,0.3);
            border: 1px solid var(--primary-gold);
            padding: 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .option:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateX(5px);
        }

        .option.selected {
            background: var(--primary-gold);
            color: var(--deep-black);
        }

        .option.correct {
            background: var(--success-green);
            color: white;
        }

        .option.incorrect {
            background: var(--blood-red);
            color: white;
        }

        .final-accusation {
            background: linear-gradient(145deg, rgba(139, 0, 0, 0.4), rgba(20,20,20,0.95));
            border: 3px solid var(--blood-red);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }

        .accusation-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--blood-red);
            margin-bottom: 1.5rem;
        }

        .suspect-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .suspect-option {
            background: rgba(20,20,20,0.8);
            border: 2px solid var(--primary-gold);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .suspect-option:hover {
            transform: scale(1.05);
            border-color: var(--antique-white);
        }

        .suspect-option.selected {
            background: var(--blood-red);
            border-color: var(--antique-white);
        }

        .suspect-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 0.5rem;
            overflow: hidden;
            border: 2px solid var(--primary-gold);
        }

        .suspect-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .suspect-name {
            font-size: 0.9rem;
            color: var(--primary-gold);
            font-weight: 600;
        }

        .feedback {
            background: rgba(0,0,0,0.6);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-left: 4px solid var(--primary-gold);
        }

        .feedback.correct {
            border-left-color: var(--success-green);
        }

        .feedback.incorrect {
            border-left-color: var(--blood-red);
        }

        .evidence-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .evidence-item {
            background: rgba(20,20,20,0.8);
            border: 1px solid var(--primary-gold);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .evidence-item:hover {
            transform: translateY(-3px);
            border-color: var(--antique-white);
        }

        .evidence-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .evidence-title {
            color: var(--primary-gold);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .evidence-description {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Vote tracking styles */
        .vote-status {
            background: rgba(0,0,0,0.6);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            border: 2px solid var(--primary-gold);
        }

        .vote-status.already-voted {
            border-color: var(--warning-orange);
            background: rgba(255, 140, 0, 0.1);
        }

        .vote-status.vote-submitted {
            border-color: var(--success-green);
            background: rgba(34, 139, 34, 0.1);
        }

        .vote-counter {
            font-size: 0.9rem;
            color: var(--primary-gold);
            margin-top: 1rem;
            font-style: italic;
        }

        @media (min-width: 769px) {
            .characters-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 2rem;
            }
            
            .character-card {
                padding: 2rem;
            }
            
            .nav-btn, .quiz-btn {
                min-width: auto;
                padding: 1rem 2rem;
                font-size: 1.1rem;
            }
        }

        .hidden {
            display: none !important;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(212, 175, 55, 0.3);
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gold);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="institution-logo">
        <img src="https://imgs.search.brave.com/HRK4arpUMYeAyrsT9fOntji5Lj_goPRLjVt3ODrEUi0/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9wcmF4/aXNiYXJyYW5jYWJl/cm1lamEuZWR1LmNv/L3dwLWNvbnRlbnQv/dXBsb2Fkcy8yMDI1/LzAyL0xvZ29zLVBy/YXhpcy5wbmc" alt="Institution Logo">
    </div>

    <div class="particles" id="particles"></div>

    <!-- Main page -->
    <div id="mainPage">
        <header class="header">
            <h1 class="main-title">Dead Behind The Mask</h1>
            <div class="ornament">◆</div>
            <p class="subtitle">A deadly masquerade - interactive whodunit for A2 English students</p>
            <div class="ornament">⚜</div>
        </header>

        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showAllCharacters()">👥 Meet the Characters</button>
                <button class="nav-btn" onclick="showEvidence()">🔍 Examine Evidence</button>
                <button class="nav-btn" onclick="showQuiz()">🧩 Investigation Quiz</button>
                <button class="nav-btn" onclick="showVoting()">🗳️ Cast Your Vote</button>
            </div>
        </div>
    </div>

    <!-- Characters page -->
    <div id="charactersPage" class="content hidden">
        <button class="back-btn" onclick="showMainPage()">← Back to Main</button>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 25%"></div>
        </div>
        <div class="characters-grid" id="charactersGrid"></div>
    </div>

    <!-- Evidence page -->
    <div id="evidencePage" class="content hidden">
        <button class="back-btn" onclick="showMainPage()">← Back to Main</button>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 50%"></div>
        </div>
        <div class="quiz-section">
            <h2 class="quiz-title">🔍 Physical Evidence</h2>
            <p class="evidence-description">Examine the evidence found at the scene. Each piece tells part of the story.</p>
            
            <div class="evidence-gallery">
                <div class="evidence-item">
                    <div class="evidence-icon">🥂</div>
                    <div class="evidence-title">Wine Glass</div>
                    <div class="evidence-description">Found near Victoria's body. Contains traces of her lipstick and fingerprints.</div>
                </div>
                <div class="evidence-item">
                    <div class="evidence-icon">🗝️</div>
                    <div class="evidence-title">Study Key</div>
                    <div class="evidence-description">Victoria's private study was locked. Only she and Ruby knew where the spare key was hidden.</div>
                </div>
                <div class="evidence-item">
                    <div class="evidence-icon">💰</div>
                    <div class="evidence-title">Financial Documents</div>
                    <div class="evidence-description">Bank statements showing suspicious transactions and embezzled funds.</div>
                </div>
                <div class="evidence-item">
                    <div class="evidence-icon">🎭</div>
                    <div class="evidence-title">Torn Mask</div>
                    <div class="evidence-description">A red mask found torn on the floor near the victim. Appears to have been ripped during a struggle.</div>
                </div>
                <div class="evidence-item">
                    <div class="evidence-icon">📝</div>
                    <div class="evidence-title">Blackmail Note</div>
                    <div class="evidence-description">"Your secrets will be revealed tonight unless..." - The rest is torn and unreadable.</div>
                </div>
                <div class="evidence-item">
                    <div class="evidence-icon">💍</div>
                    <div class="evidence-title">Expensive Ring</div>
                    <div class="evidence-description">Victoria's emerald ring was missing from her finger, but later found in a flower pot.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quiz page -->
    <div id="quizPage" class="content hidden">
        <button class="back-btn" onclick="showMainPage()">← Back to Main</button>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 75%"></div>
        </div>
        <div class="quiz-section">
            <h2 class="quiz-title">🧩 Investigation Quiz</h2>
            <p class="quiz-description">Test your detective skills. Answer these questions based on the evidence and character information.</p>
            
            <div id="quizQuestions"></div>
            <button class="quiz-btn" onclick="checkQuizAnswers()" id="checkQuizBtn">Check Answers</button>
            <div id="quizResults"></div>
        </div>
    </div>

    <!-- Voting page -->
    <div id="votingPage" class="content hidden">
        <button class="back-btn" onclick="showMainPage()">← Back to Main</button>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 100%"></div>
        </div>
        <div class="final-accusation">
            <h2 class="accusation-title">🗳️ Cast Your Vote</h2>
            <p class="vote-description">Who do you think is the killer? Your vote will help us understand how well our mystery works!</p>
            
            <div id="voteStatus"></div>
            <div class="suspect-grid" id="voteSuspectGrid"></div>
            <button class="vote-btn" onclick="submitVote()" id="voteBtn" style="display: none;">🗳️ Submit Vote</button>
            <div id="voteResult"></div>
            <div class="vote-counter" id="voteCounter"></div>
        </div>
    </div>

    <script>
        // Character data with enhanced vocabulary assistance
        const charactersData = {
            "VICTIM": {
                name: "Victoria Sterling",
                role: "The Victim",
                age: 45,
                image: "https://i.pinimg.com/736x/6f/df/03/6fdf03cd229027ff418c1e5882d1d4df.jpg",
                occupation: "Wealthy socialite",
                traits: "Assertive, controlling, wealthy, secretive",
                publicInfo: "Hosted the annual masked ball. Tense and distracted during the evening.",
                hiddenInfo: [
                    "Discovered Ruby's embezzlement",
                    "Refused to help Marcus with gambling debts", 
                    "Blackmailed several guests",
                    "Had stolen art and rare books",
                    "Was planning to arrest Watson",
                    "Suffered from a terminal illness (kept secret)"
                ],
                audioText: "Good evening, everyone. Welcome to my annual masquerade ball. I do hope you all enjoy the evening... though I suspect some of you may find it rather... revealing."
            },
            "JAMES": {
                name: "James Hartwell",
                role: "Business partner",
                age: 50,
                image: "https://i.pinimg.com/736x/6e/47/40/6e4740665ac9d5265856c98d7fa86628.jpg",
                motive: "Financial gain by stopping a merger he opposed",
                location: "Drinks table (alone)",
                alibi: "Claims Dr. Cross might've seen him",
                hiddenInfo: [
                    "Had the most to lose financially from the merger",
                    "Also had much to gain if Victoria's deal was stopped",
                    "Claimed Dr. Cross was nearby, but she said he was distracted"
                ],
                audioText: "This merger will ruin everything I've worked for. Victoria doesn't understand the consequences of her decisions."
            },
            "DIANA": {
                name: "Diana Blackwood",
                role: "Younger sister",
                age: 38,
                image: "https://i.pinimg.com/1200x/34/7d/64/347d6422190297cf94b1dd9d8c1c8c09.jpg",
                motive: "Inheritance",
                location: "By stairs with Ruby",
                alibi: "Ruby (but she briefly left)",
                hiddenInfo: [
                    "Stood to inherit everything",
                    "Seems genuinely shocked by the murder",
                    "Her alibi is partially contradicted"
                ],
                audioText: "Victoria has always been the successful one. Sometimes I wonder what my life would be like if things were different."
            },
            "EDMUND": {
                name: "Professor Edmund Grey",
                role: "Former teacher",
                age: 62,
                image: "https://i.pinimg.com/736x/9c/ca/78/9cca787cc2fb9cb5296f319be9a3f731.jpg",
                motive: "Blackmail over stolen manuscripts",
                location: "Bookshelf",
                alibi: "Possibly seen by Lord Percival",
                hiddenInfo: [
                    "Victoria stole rare documents",
                    "He was blackmailing her to return them",
                    "Alibi is weak and indirect"
                ],
                audioText: "Those manuscripts belong in a university, not in some private collector's vault. Victoria has no right to keep them."
            },
            "RUBY": {
                name: "Ruby Martinez",
                role: "Personal assistant",
                age: 28,
                image: "https://i.pinimg.com/736x/18/60/c8/1860c8717df2028d085e8f1c1448a14a.jpg",
                motive: "Victoria discovered her embezzlement",
                location: "Claimed to be with Diana",
                alibi: "Diana, but confessed to lying",
                hiddenInfo: [
                    "Actual killer",
                    "Embezzled money",
                    "Was going to be exposed publicly that night",
                    "Used blackout to strike Victoria"
                ],
                audioText: "I've worked so hard for Victoria. I deserve more than what she pays me. Sometimes you have to take what you're owed."
            },
            "PERCIVAL": {
                name: "Lord Percival Ashworth",
                role: "Ex-fiancé",
                age: 47,
                image: "https://i.pinimg.com/736x/65/9a/95/659a9590e5dc51545d2436e85c24734c.jpg",
                motive: "Blackmail over financial ruin",
                location: "Fireplace (alone)",
                alibi: "Claims Professor Grey might've seen him",
                hiddenInfo: [
                    "Was secretly bankrupt",
                    "Victoria blackmailed him about it",
                    "Paranoid and possibly vengeful"
                ],
                audioText: "Victoria thinks she can control everyone with her secrets. But everyone has their breaking point."
            },
            "JASON": {
                name: "Dr. Jason Cross",
                role: "Family doctor",
                age: 54,
                image: "https://i.pinimg.com/1200x/8d/91/db/8d91db07f440a380faeb2ca0966595bf.jpg",
                motive: "Falsified medical records",
                location: "Near drinks table",
                alibi: "James nearby (no mutual confirmation)",
                hiddenInfo: [
                    "Covered up Victoria's terminal illness",
                    "Risked exposure of professional misconduct",
                    "His and James's stories don't line up"
                ],
                audioText: "As a doctor, I must keep my patients' secrets. But sometimes those secrets can destroy lives."
            },
            "MARCUS": {
                name: "Marcus Wilde",
                role: "Nephew",
                age: 32,
                image: "https://i.pinimg.com/736x/13/17/6f/13176f6d58bfc94fdfed02b66a89dabf.jpg",
                motive: "Denied help with gambling debts",
                location: "Near window with Isabella",
                alibi: "Confirmed by Isabella",
                hiddenInfo: [
                    "Owed dangerous people large sums",
                    "Victoria had just refused to help him",
                    "Showed signs of stress and paranoia"
                ],
                audioText: "Aunt Victoria doesn't understand. These aren't just debts - these are threats. I need that money or I'm a dead man."
            },
            "ISABELLA": {
                name: "Isabella Fontaine",
                role: "Business rival",
                age: 41,
                image: "https://i.pinimg.com/736x/6a/70/b7/6a70b738ad0f5c75687a12112fe29922.jpg",
                motive: "Legal and financial losses",
                location: "With Marcus",
                alibi: "Confirmed by Marcus",
                hiddenInfo: [
                    "Recently lost a major lawsuit to Victoria",
                    "Was facing bankruptcy",
                    "Had access to sensitive info about Victoria's calls"
                ],
                audioText: "Victoria Sterling has ruined my business with her lawsuits. She takes pleasure in destroying people."
            },
            "WATSON": {
                name: "Detective Watson",
                role: "Family friend, off-duty police",
                age: 45,
                image: "https://i.pinimg.com/736x/c8/51/42/c85142767052a1ad4fc75ecd665f00a4.jpg",
                motive: "Victoria's criminal activities",
                location: "Circulating",
                alibi: "None — no witnesses",
                hiddenInfo: [
                    "Investigating money laundering",
                    "Was planning to arrest Victoria",
                    "Unclear whereabouts during blackout"
                ],
                audioText: "Justice must be served, even when it involves friends. The law applies to everyone, regardless of wealth or status."
            },
            "SOPHIA": {
                name: "Sophia Chen",
                role: "Art dealer",
                age: 36,
                image: "https://i.pinimg.com/736x/9b/37/49/9b3749675bd3a054d516a393a793f9c6.jpg",
                motive: "Coerced participation in stolen art sales",
                location: "Alone with artwork",
                alibi: "None",
                hiddenInfo: [
                    "Helped Victoria sell stolen art",
                    "Was being blackmailed to continue",
                    "Victoria wanted \"quick sales\" and \"untraceable transactions\""
                ],
                audioText: "I never wanted to be involved in this. Victoria forced me to help her sell those stolen pieces. I'm trapped."
            }
        };

        // Quiz questions based on the story
        const quizQuestions = [
            {
                question: "What was the main reason Ruby had for wanting to harm Victoria?",
                options: [
                    "Victoria was rude to her",
                    "Victoria discovered her embezzlement",
                    "Victoria didn't pay her enough",
                    "Victoria was going to fire her"
                ],
                correct: 1,
                explanation: "Ruby had been embezzling money, and Victoria had discovered this. Ruby was going to be exposed publicly that night."
            },
            {
                question: "Who claimed to be Ruby's alibi during the blackout?",
                options: [
                    "Marcus",
                    "Diana",
                    "James",
                    "Nobody"
                ],
                correct: 1,
                explanation: "Diana claimed Ruby was with her by the stairs, but Ruby later confessed to lying about her location."
            },
            {
                question: "What illness was Victoria secretly suffering from?",
                options: [
                    "Heart disease",
                    "A terminal illness",
                    "Depression",
                    "She wasn't ill"
                ],
                correct: 1,
                explanation: "Victoria was suffering from a terminal illness, which Dr. Cross had been helping her keep secret."
            },
            {
                question: "What did Professor Grey accuse Victoria of stealing?",
                options: [
                    "Money",
                    "Jewelry",
                    "Rare manuscripts",
                    "Art pieces"
                ],
                correct: 2,
                explanation: "Professor Grey claimed Victoria had stolen rare documents and manuscripts, and he was blackmailing her to return them."
            },
            {
                question: "Who had the weakest alibi during the blackout?",
                options: [
                    "Marcus (with Isabella)",
                    "Ruby (claimed to be with Diana)",
                    "James (at drinks table)",
                    "Detective Watson (circulating)"
                ],
                correct: 3,
                explanation: "Detective Watson had no witnesses to confirm his whereabouts during the blackout, making his alibi the weakest."
            }
        ];

        // Vocabulary words dictionary
        const vocabWords = {
            'masquerade': 'A formal dance party where people wear masks',
            'whodunit': 'A mystery story where readers try to solve a crime',
            'evidence': 'Proof or signs that help solve a crime',
            'detective': 'A person who investigates crimes',
            'alibi': 'Proof that someone was elsewhere when a crime was committed',
            'motive': 'A reason for committing a crime',
            'suspect': 'A person believed to have committed a crime',
            'embezzlement': 'Stealing money that was entrusted to you',
            'blackmail': 'Threatening to reveal secrets unless demands are met',
            'accusation': 'A formal charge that someone committed a crime'
        };

        // Voting system variables
        let selectedVoteSuspect = null;
        let quizAnswers = [];

        // Google Sheets configuration
        const GOOGLE_SHEET_CONFIG = {
  url: 'https://script.google.com/macros/s/AKfycbz-l6IStpTqnmosmvEPrVxJM3NZ-nFeoRmHFl9eUP32latY0yC_CUSXvp8wtPdtRcvVMQ/exec'
};


        // Enhanced vocabulary helper - FIXED VERSION
        function addVocabularyHelpers(text, skipVocab = false) {
            if (skipVocab || !text) return text;
            
            let enhancedText = text;
            Object.entries(vocabWords).forEach(([word, definition]) => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                enhancedText = enhancedText.replace(regex, `<span class="vocab-word" title="${definition}">${word}</span>`);
            });
            return enhancedText;
        }

        // Safe vocabulary helper for specific elements only
        function addVocabularyToContent(element) {
            // Only apply vocabulary to specific classes/elements
            const targetSelectors = [
                '.character-description',
                '.motive-text', 
                '.clue-item',
                '.evidence-description:not(.quiz-title *)',
                '.vote-description'
            ];
            
            targetSelectors.forEach(selector => {
                const elements = element.querySelectorAll ? element.querySelectorAll(selector) : document.querySelectorAll(selector);
                elements.forEach(el => {
                    if (el.dataset.vocabProcessed) return; // Skip if already processed
                    el.innerHTML = addVocabularyHelpers(el.innerHTML);
                    el.dataset.vocabProcessed = 'true';
                });
            });
        }

        // Vote tracking functions
        function hasUserVoted() {
            return localStorage.getItem('deadBehindMask_hasVoted') === 'true';
        }

        function markUserAsVoted(suspectName) {
            localStorage.setItem('deadBehindMask_hasVoted', 'true');
            localStorage.setItem('deadBehindMask_votedFor', suspectName);
            localStorage.setItem('deadBehindMask_voteTime', new Date().toISOString());
        }

        function getUserVote() {
            return localStorage.getItem('deadBehindMask_votedFor');
        }

        function updateVoteCounter() {
            const counter = document.getElementById('voteCounter');
            if (counter) {
                let totalVotes = localStorage.getItem('deadBehindMask_totalVotes') || 0;
                counter.textContent = `Total votes collected: ${totalVotes}`;
            }
        }

        // Enhanced particle creation
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 60;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 12 + 's';
                particle.style.animationDuration = (10 + Math.random() * 4) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Text-to-speech functionality
        function playCharacterAudio(text, characterName) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;

                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    if (characterName.includes('Victoria')) {
                        utterance.pitch = 1.2;
                    } else if (characterName.includes('Professor') || characterName.includes('Edmund')) {
                        utterance.rate = 0.8;
                    } else if (characterName.includes('Ruby')) {
                        utterance.pitch = 1.1;
                    }
                }

                speechSynthesis.speak(utterance);
            } else {
                alert('Sorry, your browser doesn\'t support text-to-speech functionality.');
            }
        }

        // Show all characters page
        function showAllCharacters() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('charactersPage').classList.remove('hidden');
            
            const grid = document.getElementById('charactersGrid');
            grid.innerHTML = '';

            Object.entries(charactersData).forEach(([key, character]) => {
                const card = document.createElement('div');
                card.className = character.name === 'Victoria Sterling' ? 'character-card victim-card' : 'character-card';
                
                let cardContent = `
                    <div class="character-avatar">
                        <img src="${character.image}" alt="${character.name}" onerror="this.style.display='none'">
                    </div>
                    <div class="character-name">${character.name}</div>
                    <div class="character-role">${character.role}</div>
                    <div class="character-age">Age: ${character.age}</div>
                    <button class="audio-btn" onclick="playCharacterAudio('${character.audioText}', '${character.name}')">🔊 Hear Character</button>
                `;

                if (key === "VICTIM") {
                    cardContent += `
                        <div class="character-description">
                            <strong>Occupation:</strong> ${character.occupation}<br>
                            <strong>Known Traits:</strong> ${character.traits}<br>
                            <strong>Public Info:</strong> ${character.publicInfo}
                        </div>
                        <div class="character-motive">
                            <div class="motive-title">Status</div>
                            <div class="motive-text">Found dead during the masquerade ball blackout</div>
                        </div>
                        <div class="clues-section">
                            <div class="clues-title" onclick="toggleClues(this)">🔍 Reveal Hidden Info</div>
                            <div class="clues-content">
                                ${character.hiddenInfo.map(info => `<div class="clue-item">${info}</div>`).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    cardContent += `
                        <div class="character-motive">
                            <div class="motive-title">Motive</div>
                            <div class="motive-text">${character.motive}</div>
                        </div>
                        <div class="character-description">
                            <strong>Location During Blackout:</strong> ${character.location}<br>
                            <strong>Alibi:</strong> ${character.alibi}
                        </div>
                        <div class="clues-section">
                            <div class="clues-title" onclick="toggleClues(this)">🔍 Reveal Hidden Info</div>
                            <div class="clues-content">
                                ${character.hiddenInfo.map(info => `<div class="clue-item">${info}</div>`).join('')}
                            </div>
                        </div>
                    `;
                }
                
                card.innerHTML = cardContent;
                grid.appendChild(card);
                
                // Apply vocabulary helpers only to specific parts
                addVocabularyToContent(card);
            });
        }

        // Show evidence page
        function showEvidence() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('evidencePage').classList.remove('hidden');
            
            // Apply vocabulary to evidence descriptions
            setTimeout(() => {
                addVocabularyToContent(document.getElementById('evidencePage'));
            }, 100);
        }

        // Show quiz page
        function showQuiz() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('quizPage').classList.remove('hidden');
            
            const questionsContainer = document.getElementById('quizQuestions');
            questionsContainer.innerHTML = '';
            quizAnswers = new Array(quizQuestions.length).fill(-1);

            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                // Don't apply vocabulary to questions and options
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}: ${q.question}</h3>
                    <div class="question-options">
                        ${q.options.map((option, optIndex) => `
                            <div class="option" onclick="selectQuizAnswer(${index}, ${optIndex})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
        }

        // Show voting page
        function showVoting() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('votingPage').classList.remove('hidden');
            
            const voteStatusDiv = document.getElementById('voteStatus');
            const suspectGrid = document.getElementById('voteSuspectGrid');
            const voteBtn = document.getElementById('voteBtn');
            
            suspectGrid.innerHTML = '';
            
            if (hasUserVoted()) {
                const votedFor = getUserVote();
                voteStatusDiv.innerHTML = `
                    <div class="vote-status already-voted">
                        <h3>✅ You have already voted</h3>
                        <p>You voted for: <strong>${votedFor}</strong></p>
                        <p>Thank you for your participation! Each person can only vote once.</p>
                    </div>
                `;
                voteBtn.style.display = 'none';
            } else {
                voteStatusDiv.innerHTML = `
                    <div class="vote-status">
                        <h3>🗳️ Choose Your Suspect</h3>
                        <p>Select who you believe is the killer and submit your vote.</p>
                    </div>
                `;
                
                // Show all suspects except the victim
                Object.entries(charactersData).forEach(([key, character]) => {
                    if (key !== 'VICTIM') {
                        const suspectDiv = document.createElement('div');
                        suspectDiv.className = 'suspect-option';
                        suspectDiv.onclick = () => selectVoteSuspect(character.name, suspectDiv);
                        suspectDiv.innerHTML = `
                            <div class="suspect-avatar">
                                <img src="${character.image}" alt="${character.name}" onerror="this.style.display='none'">
                            </div>
                            <div class="suspect-name">${character.name}</div>
                        `;
                        suspectGrid.appendChild(suspectDiv);
                    }
                });
            }
            
            updateVoteCounter();
        }

        // Select suspect for voting
        function selectVoteSuspect(name, element) {
            if (hasUserVoted()) return;
            
            document.querySelectorAll('.suspect-option').forEach(opt => 
                opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedVoteSuspect = name;
            document.getElementById('voteBtn').style.display = 'inline-block';
        }

        // Submit vote to Google Sheets
        async function submitVote() {
            if (!selectedVoteSuspect || hasUserVoted()) return;

            const voteBtn = document.getElementById('voteBtn');
            const originalText = voteBtn.textContent;
            voteBtn.textContent = 'Submitting...';
            voteBtn.disabled = true;

            try {
                // Prepare vote data
                const voteData = {
                    suspect: selectedVoteSuspect,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    referrer: document.referrer,
                    sessionId: generateSessionId()
                };

                // Try to submit to Google Sheets (you'll need to set up the endpoint)
                await submitToGoogleSheets(voteData);
                
                // Mark user as voted
                markUserAsVoted(selectedVoteSuspect);
                
                // Update vote counter
                let totalVotes = parseInt(localStorage.getItem('deadBehindMask_totalVotes') || '0');
                totalVotes++;
                localStorage.setItem('deadBehindMask_totalVotes', totalVotes.toString());
                
                // Show success message
                document.getElementById('voteResult').innerHTML = `
                    <div class="vote-status vote-submitted">
                        <h3>🎉 Vote Submitted Successfully!</h3>
                        <p>Thank you for participating in our mystery! Your vote for <strong>${selectedVoteSuspect}</strong> has been recorded.</p>
                        <p>Your feedback helps us improve our educational content.</p>
                    </div>
                `;
                
                // Hide vote button and suspects
                voteBtn.style.display = 'none';
                document.getElementById('voteSuspectGrid').style.display = 'none';
                updateVoteCounter();
            } catch (error) {
                console.error('Error submitting vote:', error);
                document.getElementById('voteResult').innerHTML = `
                    <div class="vote-status">
                        <h3>⚠️ Submission Error</h3>
                        <p>We couldn't submit your vote right now, but we've saved it locally. Thank you for participating!</p>
                    </div>
                `;
                // Still mark as voted to prevent multiple attempts
                markUserAsVoted(selectedVoteSuspect);
                voteBtn.style.display = 'none';
            }
        }

        // Generate simple session ID
        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Submit to Google Sheets function
        async function submitToGoogleSheets(voteData) {
            // Method 1: Using Google Apps Script Web App (recommended)
            if (GOOGLE_SHEET_CONFIG.url !== 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec') {
                const response = await fetch(GOOGLE_SHEET_CONFIG.url, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(voteData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to submit to Google Sheets');
                }
                return response.json();
            }
            
            // Method 2: Using Google Forms (alternative)
            // This is a fallback that creates a form submission
            const formData = new FormData();
            formData.append('entry.123456789', voteData.suspect); // Replace with actual form field ID
            formData.append('entry.987654321', voteData.timestamp);
            
            // Note: This will likely be blocked by CORS, but provides a backup method
            return fetch(GOOGLE_SHEET_CONFIG.formUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            });
        }

        // Select quiz answer
        function selectQuizAnswer(questionIndex, optionIndex) {
            const question = document.querySelectorAll('.question')[questionIndex];
            const options = question.querySelectorAll('.option');
            
            options.forEach(opt => opt.classList.remove('selected'));
            options[optionIndex].classList.add('selected');
            
            quizAnswers[questionIndex] = optionIndex;
        }

        // Check quiz answers
        function checkQuizAnswers() {
            const questions = document.querySelectorAll('.question');
            let score = 0;

            questions.forEach((question, index) => {
                const options = question.querySelectorAll('.option');
                const correctIndex = quizQuestions[index].correct;
                const userAnswer = quizAnswers[index];

                options.forEach((opt, optIndex) => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                    if (optIndex === correctIndex) {
                        opt.classList.add('correct');
                    } else if (optIndex === userAnswer && userAnswer !== correctIndex) {
                        opt.classList.add('incorrect');
                    }
                });

                if (userAnswer === correctIndex) {
                    score++;
                }

                // Add explanation with vocabulary
                if (!question.querySelector('.feedback')) {
                    const feedback = document.createElement('div');
                    feedback.className = userAnswer === correctIndex ? 'feedback correct' : 'feedback incorrect';
                    feedback.innerHTML = `<strong>Explanation:</strong> ${addVocabularyHelpers(quizQuestions[index].explanation)}`;
                    question.appendChild(feedback);
                }
            });

            const resultsDiv = document.getElementById('quizResults');
            const percentage = Math.round((score / quizQuestions.length) * 100);
            resultsDiv.innerHTML = `
                <div class="feedback ${percentage >= 70 ? 'correct' : 'incorrect'}">
                    <h3>Quiz Results</h3>
                    <p>You scored ${score} out of ${quizQuestions.length} (${percentage}%)</p>
                    <p>${percentage >= 70 ? 'Great detective work! You understand the case well.' : 'Review the evidence and try again. Every good detective learns from their mistakes.'}</p>
                </div>
            `;

            document.getElementById('checkQuizBtn').style.display = 'none';
        }

        // Show main page
        function showMainPage() {
            document.querySelectorAll('[id$="Page"]').forEach(page => 
                page.classList.add('hidden'));
            document.getElementById('mainPage').classList.remove('hidden');
        }

        // Toggle clues visibility
        function toggleClues(element) {
            const content = element.nextElementSibling;
            content.classList.toggle('revealed');
            element.textContent = content.classList.contains('revealed') ? 
                '🔍 Hide Hidden Info' : '🔍 Reveal Hidden Info';
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // Load voices for text-to-speech
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
                speechSynthesis.addEventListener('voiceschanged', function() {
                    speechSynthesis.getVoices();
                });
            }
            
            // Apply vocabulary to main subtitle
            setTimeout(() => {
                const subtitle = document.querySelector('.subtitle');
                if (subtitle && !subtitle.dataset.vocabProcessed) {
                    subtitle.innerHTML = addVocabularyHelpers(subtitle.innerHTML);
                    subtitle.dataset.vocabProcessed = 'true';
                }
            }, 2000); // Wait for animations to complete
        });
    </script>
</body>
</html>
